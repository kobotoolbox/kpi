# Generated by Django 3.2.15 on 2024-02-12 15:47

from django.conf import settings
from django.db import migrations

from kpi.constants import (
    ASSET_TYPE_SURVEY,
    PERM_ADD_SUBMISSIONS,
)


def remove_add_submissions_for_anonymous_user(apps, schema_editor):

    Asset = apps.get_model('kpi', 'Asset')  # noqa
    ObjectPermission = apps.get_model('kpi', 'ObjectPermission')  # noqa
    Permission = apps.get_model('auth', 'Permission')  # noqa
    permission_id = Permission.objects.get(codename=PERM_ADD_SUBMISSIONS).pk

    ObjectPermission.objects.filter(
        permission_id=permission_id,
        user_id=settings.ANONYMOUS_USER_ID,
    ).exclude(asset__asset_type=ASSET_TYPE_SURVEY).delete()


def noop(apps, schema_editor):
    pass


class Migration(migrations.Migration):

    dependencies = [
        ('kpi', '0055_set_require_auth_per_project'),
    ]

    operations = [
        migrations.RunPython(
            remove_add_submissions_for_anonymous_user,
            noop,
        ),
    ]
