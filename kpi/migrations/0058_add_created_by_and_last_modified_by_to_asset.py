# Generated by Django 4.2.15 on 2024-08-18 11:38

from django.db import migrations, models
from django.conf import settings
from django.core.management import call_command


def populate_asset_created_by_and_last_modified_by(apps, schema_editor):
    if settings.SKIP_HEAVY_MIGRATIONS:
        print(
            """
            !!! ATTENTION !!!
            If you have existing assets you need to run this management command:

               > python manage.py populate_asset_created_and_modified_by

            Otherwise, the 'created_by' and 'last_modified_by' fields will
            not be populated for existing assets.
            """
        )
    else:
        print(
            """
            This might take a while. If it is too slow, you may want to re-run
            the migration with SKIP_HEAVY_MIGRATIONS=True and run the management
            command `populate_asset_created_and_modified_by`.
            """
        )
        call_command('populate_asset_created_and_modified_by', verbosity=0)


def noop(apps, schema_editor):
    pass


class Migration(migrations.Migration):

    dependencies = [
        ('kpi', '0057_add_index_on_kpi_asset__deployment_data__formid'),
    ]

    operations = [
        migrations.AddField(
            model_name='asset',
            name='created_by',
            field=models.CharField(
                blank=True, db_index=True, max_length=150, null=True
            ),
        ),
        migrations.AddField(
            model_name='asset',
            name='last_modified_by',
            field=models.CharField(
                blank=True, db_index=True, max_length=150, null=True
            ),
        ),
        migrations.RunPython(
            populate_asset_created_by_and_last_modified_by,
            noop,
        )
    ]
