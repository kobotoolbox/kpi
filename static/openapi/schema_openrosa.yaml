openapi: 3.0.3
info:
  title: KoboToolbox OpenRosa API
  version: openrosa
  description: |-
    Welcome to the documentation for the KoboToolbox OpenRosa API. Data collection clients, including KoboCollect and web forms, use the API endpoints described here to retrieve surveys and upload submissions.

    Our separate documentation of the primary KoboToolbox API endpoints, used to manage projects and data, can be found [here](/api/v2/docs/).
paths:
  /{username}/formList:
    get:
      operationId: form_list_anonymous
      description: |
        ## Implement part of the OpenRosa Form List API

        ⚠️This endpoint is **only available** from the Kobocat domains (ex: kc.kobotoolbox.org or kc-eu.kobotoolbox.org)⚠️

        This endpoint is used for adding submissions as anonymous user.
      parameters:
      - in: path
        name: username
        schema:
          type: string
          pattern: ^\w+$
        required: true
      tags:
      - OpenRosa Form List
      security:
      - TokenAuth: []
      - {}
      responses:
        '200':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/XFormList'
          description: null
  /{username}/submission:
    post:
      operationId: submission_anonymous
      description: |+
        ## Implement the OpenRosa Form Submission API

        ⚠️This endpoint is only available from the Kobocat domains (ex: kc.kobotoolbox.org or kc-eu.kobotoolbox.org)⚠️

        This endpoint is used for adding submissions as an anonymous user.

      parameters:
      - in: query
        name: format
        schema:
          type: string
          enum:
          - json
          - xml
      - in: path
        name: username
        schema:
          type: string
          pattern: ^\w+$
        required: true
      tags:
      - OpenRosa Form Submission
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/OpenRosaPayload'
        required: true
      security:
      - BasicAuth: []
      - TokenAuth: []
      - {}
      responses:
        '200':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/OpenRosaResponse'
          description: null
        '401':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorDetail'
              examples:
                NotAuthenticated:
                  value:
                    detail: Authentication credentials were not provided.
                  summary: Not authenticated
          description: ''
        '404':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorDetail'
              examples:
                NotFound:
                  value:
                    detail: Not found.
                  summary: Not Found
          description: ''
        '400':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorObject'
              examples:
                BadRequest:
                  value:
                    detail:
                      field_name:
                      - Error message
                  summary: Bad request
          description: ''
  /{username}/xformsManifest/{id}:
    get:
      operationId: manifest_anonymous
      description: |
        ## Implement part of the OpenRosa Manifest API

        ⚠️This endpoint is **only available** from the Kobocat domains (ex: kc.kobotoolbox.org or kc-eu.kobotoolbox.org)⚠️

        This endpoint return the URLs of form media files so they can be fetched and displayed as needed during form rendering.
        This endpoints will also open the form in **creation** mode and is used as an anonymous user.
      parameters:
      - in: path
        name: id
        schema:
          type: string
          pattern: ^[\d+^/]+$
        required: true
      - in: path
        name: username
        schema:
          type: string
          pattern: ^\w+$
        required: true
      tags:
      - OpenRosa Form Manifest
      security:
      - TokenAuth: []
      - {}
      responses:
        '200':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/OpenRosaFormManifestResponse'
          description: null
        '404':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorDetail'
              examples:
                NotFound:
                  value:
                    detail: Not found.
                  summary: Not Found
          description: ''
  /api/v2/asset_snapshots/{uid_asset_snapshot}/formList:
    get:
      operationId: api_v2_asset_snapshots_formList_retrieve
      description: |
        ## Implement part of the OpenRosa Form List API

        This endpoint is used to edit the enketo submission and requires authentication
      parameters:
      - in: path
        name: uid_asset_snapshot
        schema:
          type: string
        description: UID of the asset snapshot
        required: true
      tags:
      - OpenRosa Form List
      security:
      - BasicAuth: []
      - TokenAuth: []
      responses:
        '200':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/OpenRosaFormListResponse'
          description: null
        '404':
          description: No response body
  /api/v2/asset_snapshots/{uid_asset_snapshot}/manifest:
    get:
      operationId: api_v2_asset_snapshots_manifest_retrieve
      description: |
        ## Implement part of the OpenRosa Form List API

        This endpoint is used by Enketo when loading a form.
        It returns the URLs of form media files so they can be fetched and displayed as
        needed during form rendering and will open the form in edit mode.
      parameters:
      - in: path
        name: uid_asset_snapshot
        schema:
          type: string
        description: UID of the asset snapshot
        required: true
      tags:
      - OpenRosa Form Manifest
      security:
      - BasicAuth: []
      - TokenAuth: []
      responses:
        '200':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/OpenRosaManifestResponse'
          description: null
        '404':
          description: No response body
  /api/v2/asset_snapshots/{uid_asset_snapshot}/submission:
    post:
      operationId: api_v2_asset_snapshots_submission_create
      description: |
        ## Implement the OpenRosa Form Submission API

        This endpoint is used only when saving edited submissions in KPI.
        Note: New submissions are still handled via the legacy v1 submission API.
      parameters:
      - in: path
        name: uid_asset_snapshot
        schema:
          type: string
        description: UID of the asset snapshot
        required: true
      tags:
      - OpenRosa Form Submission
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/OpenRosaSubmissionRequest'
        required: true
      responses:
        '201':
          content:
            text/xml:
              schema:
                $ref: '#/components/schemas/OpenRosaSubmissionResponse'
          description: null
        '401':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorDetail'
              examples:
                NotAuthenticated:
                  value:
                    detail: Authentication credentials were not provided.
                  summary: Not authenticated
          description: ''
  /formList:
    get:
      operationId: form_list_authenticated
      description: |
        ## Implement part of the OpenRosa Form List API

        ⚠️This endpoint is **only available** from the Kobocat domains (ex: kc.kobotoolbox.org or kc-eu.kobotoolbox.org)⚠️

        This endpoint is used for adding submissions as authenticated user.
      tags:
      - OpenRosa Form List
      security:
      - TokenAuth: []
      - {}
      responses:
        '200':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/XFormList'
          description: null
  /key/{token}/formList:
    get:
      operationId: form_list_data_collector
      description: |
        ## Implement part of the OpenRosa Form List API

        ⚠️This endpoint is **only available** from the Kobocat domains (ex: kc.kobotoolbox.org or kc-eu.kobotoolbox.org)⚠️

        This endpoint is used for adding submissions as a data collector.
      parameters:
      - in: path
        name: token
        schema:
          type: string
          pattern: ^\w+$
        required: true
      tags:
      - OpenRosa Form List
      security:
      - TokenAuth: []
      - {}
      responses:
        '200':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/XFormList'
          description: null
  /key/{token}/submission:
    post:
      operationId: submission_data_collector
      description: |+
        ## Implement the OpenRosa Form Submission API

        ⚠️This endpoint is only available from the Kobocat domains (ex: kc.kobotoolbox.org or kc-eu.kobotoolbox.org)⚠️

        This endpoint is used for adding submissions as a data collector.

      parameters:
      - in: query
        name: format
        schema:
          type: string
          enum:
          - json
          - xml
      - in: path
        name: token
        schema:
          type: string
          pattern: ^\w+$
        required: true
      tags:
      - OpenRosa Form Submission
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/OpenRosaPayload'
        required: true
      security:
      - BasicAuth: []
      - TokenAuth: []
      - {}
      responses:
        '200':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/OpenRosaResponse'
          description: null
        '401':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorDetail'
              examples:
                NotAuthenticated:
                  value:
                    detail: Authentication credentials were not provided.
                  summary: Not authenticated
          description: ''
        '404':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorDetail'
              examples:
                NotFound:
                  value:
                    detail: Not found.
                  summary: Not Found
          description: ''
        '400':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorObject'
              examples:
                BadRequest:
                  value:
                    detail:
                      field_name:
                      - Error message
                  summary: Bad request
          description: ''
  /key/{token}/xformsManifest/{id}:
    get:
      operationId: manifest_data_collector
      description: |
        ## Implement part of the OpenRosa Manifest API

        ⚠️This endpoint is **only available** from the Kobocat domains (ex: kc.kobotoolbox.org or kc-eu.kobotoolbox.org)⚠️

        This endpoint return the URLs of form media files so they can be fetched and displayed as needed during form rendering.
        This endpoints will also open the form in **creation** mode and is used as an anonymous user.
      parameters:
      - in: path
        name: id
        schema:
          type: string
          pattern: ^[\d+^/]+$
        required: true
      - in: path
        name: token
        schema:
          type: string
          pattern: ^\w+$
        required: true
      tags:
      - OpenRosa Form Manifest
      security:
      - TokenAuth: []
      - {}
      responses:
        '200':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/OpenRosaFormManifestResponse'
          description: null
        '404':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorDetail'
              examples:
                NotFound:
                  value:
                    detail: Not found.
                  summary: Not Found
          description: ''
  /submission:
    post:
      operationId: submission_authenticated
      description: |+
        ## Implement the OpenRosa Form Submission API

        ⚠️This endpoint is only available from the Kobocat domains (ex: kc.kobotoolbox.org or kc-eu.kobotoolbox.org)⚠️

        This endpoint is used for adding submissions as an authenticated user.

      parameters:
      - in: query
        name: format
        schema:
          type: string
          enum:
          - json
          - xml
      tags:
      - OpenRosa Form Submission
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/OpenRosaPayload'
        required: true
      security:
      - BasicAuth: []
      - TokenAuth: []
      - {}
      responses:
        '200':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/OpenRosaResponse'
          description: null
        '401':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorDetail'
              examples:
                NotAuthenticated:
                  value:
                    detail: Authentication credentials were not provided.
                  summary: Not authenticated
          description: ''
        '404':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorDetail'
              examples:
                NotFound:
                  value:
                    detail: Not found.
                  summary: Not Found
          description: ''
        '400':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorObject'
              examples:
                BadRequest:
                  value:
                    detail:
                      field_name:
                      - Error message
                  summary: Bad request
          description: ''
  /xformsManifest/{id}:
    get:
      operationId: manifest_authenticated
      description: |
        ## Implement part of the OpenRosa Manifest API

        ⚠️This endpoint is **only available** from the Kobocat domains (ex: kc.kobotoolbox.org or kc-eu.kobotoolbox.org)⚠️

        This endpoint return the URLs of form media files so they can be fetched and displayed as needed during form rendering.
        This endpoints will also open the form in **creation** mode and is used as an authenticated user.
      parameters:
      - in: path
        name: id
        schema:
          type: string
          pattern: ^[\d+^/]+$
        required: true
      tags:
      - OpenRosa Form Manifest
      security:
      - TokenAuth: []
      - {}
      responses:
        '200':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/OpenRosaFormManifestResponse'
          description: null
        '404':
          content:
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorDetail'
              examples:
                NotFound:
                  value:
                    detail: Not found.
                  summary: Not Found
          description: ''
components:
  schemas:
    ErrorDetail:
      type: object
      properties:
        detail:
          type: string
      required:
      - detail
    ErrorObject:
      type: object
      properties:
        detail: {}
      required:
      - detail
    OpenRosaFormListResponse:
      type: array
      items:
        type: object
        properties:
          formID:
            type: string
          name:
            type: string
          hash:
            type: string
          descriptionText:
            type: string
          downloadUrl:
            type: string
            format: uri
            example: https://kf.kobotoolbox.org/api/v2/asset_snapshots/{uid_asset_snapshot}/xml_with_disclaimer/
          manifestUrl:
            type: string
            format: uri
            example: https://kf.kobotoolbox.org/api/v2/asset_snapshots/{uid_asset_snapshot}/manifest/
        xml:
          name: xform
      xml:
        name: xforms
        wrapped: true
    OpenRosaFormManifestResponse:
      type: array
      items:
        type: object
        properties:
          filename:
            type: string
          hash:
            type: string
          downloadUrl:
            type: string
            format: uri
            example: https://kf.kobotoolbox.org/xformsMedia/123/456.jpg
        xml:
          name: xform
      xml:
        name: xforms
        wrapped: true
    OpenRosaManifestResponse:
      type: object
      properties:
        manifest:
          type: string
          format: uri
          example: https://kf.kobotoolbox.org/api/v2/asset_snapshots/{uid_asset_snapshot}/manifest/
      required:
      - manifest
    OpenRosaPayload:
      type: object
      properties:
        xml_submission_file:
          type: string
      required:
      - xml_submission_file
    OpenRosaResponse:
      type: object
      properties:
        message:
          type: string
        submissionMetadata:
          type: object
          properties:
            id:
              type: string
            instanceID:
              type: string
            submissionDate:
              type: string
              format: date-time
            markedAsCompleteDate:
              type: string
              format: date-time
            isComplete:
              type: boolean
      required:
      - message
      - submissionMetadata
    OpenRosaSubmissionRequest:
      type: object
      properties:
        xml_submission_file:
          type: string
          format: uri
      required:
      - xml_submission_file
    OpenRosaSubmissionResponse:
      type: object
      properties:
        question:
          type: string
        meta:
          type: object
          properties:
            instanceID:
              type: string
            rootUuid:
              type: string
            deprecatedID:
              type: string
        formhub:
          type: object
          properties:
            uuid:
              type: string
      required:
      - formhub
      - meta
      - question
    XFormList:
      type: array
      items:
        type: object
        properties:
          formID:
            type: string
          name:
            type: string
          majorMinorVersion:
            type: string
          version:
            type: string
          hash:
            type: string
          description:
            type: string
          downloadUrl:
            type: string
            format: uri
            example: https://kf.kobotoolbox.org/forms/6/form.xml
          manifestUrl:
            type: string
            format: uri
            example: https://kf.kobotoolbox.org/xformsManifest/6
        xml:
          name: xform
      xml:
        name: xforms
        wrapped: true
  securitySchemes:
    BasicAuth:
      type: http
      scheme: basic
    TokenAuth:
      type: apiKey
      in: header
      name: Authorization
      description: 'Token-based authentication. Use the format: `Token <your-token>`'
