# Generated by Django 4.2.24 on 2026-02-16 14:29

from django.db import migrations, models
from django.conf import settings


def manually_create_indexes_instructions(apps, schema_editor):
    print(
        """
        ⚠️ ATTENTION ⚠️
        Run the SQL queries below in PostgreSQL directly:

        -- Create index hook_hooklo_hook_id_ae386e_idx on field(s) hook, submission_id of model hooklog
        --
        CREATE INDEX CONCURRENTLY IF NOT EXISTS "hook_hooklo_hook_id_ae386e_idx" ON "hook_hooklog" ("hook_id", "submission_id");
        -- Create constraint uniq_hook_submission on model hooklog
        --
        ALTER TABLE "hook_hooklog" ADD CONSTRAINT "uniq_hook_submission" UNIQUE ("hook_id", "submission_id");
        """
    )


def manually_drop_indexes_instructions(apps, schema_editor):
    print(
        """
        ⚠️ ATTENTION ⚠️
        Run the SQL queries below in PostgreSQL directly:

        ALTER TABLE "hook_hooklog" DROP CONSTRAINT "uniq_hook_submission";
        DROP INDEX CONCURRENTLY IF EXISTS "hook_hooklo_hook_id_ae386e_idx";
        """
    )

def get_conditional_operations():
    if settings.SKIP_HEAVY_MIGRATIONS:
        return [
            migrations.RunPython(
                manually_create_indexes_instructions,
                manually_drop_indexes_instructions,
            )
        ]
    else:
        return [
            migrations.AddIndex(
                model_name='hooklog',
                index=models.Index(
                    fields=['hook', 'submission_id'],
                    name='hook_hooklo_hook_id_ae386e_idx',
                ),
            ),
            migrations.AddConstraint(
                model_name='hooklog',
                constraint=models.UniqueConstraint(
                    fields=('hook', 'submission_id'),
                    name='uniq_hook_submission',
                ),
            ),
        ]


class Migration(migrations.Migration):

    dependencies = [
        ('hook', '0008_alter_hooklog_date_created_and_more'),
    ]

    operations = [
        migrations.AlterField(
            model_name='hooklog',
            name='status',
            field=models.PositiveSmallIntegerField(
                choices=[(0, 'failed'), (1, 'pending'), (2, 'success')], default=1
            ),
        ),
        *get_conditional_operations(),
    ]
